<?php
/**
 * 
 * @author fsw
 *
 */
class widget_Form extends Widget
{
	public $fields = array();
	
	public function handlePost($data)
	{
		$errors = array();
		foreach ($this->fields() as $key => $field)
		{
			$error = $field->validate(isset($data[$key]) ? $data[$key] : null);
			if ($error !== true)
			{
				$errors[$key] = $error;
			}
		}
		return empty($errors) ? true : $errors;
	}
	
	public function fields()
	{
		//TODO ???
		if (empty($this->fields))
		{
			$this->fields = $this->getFields();
		}
		return $this->fields; 
	}
	
	protected function getFields()
	{
		return $this->fields;
	}
	
	public function setFields($fields)
	{
		$this->fields = $fields;
	}
	
	public function __construct($skin = 'default', $name = 'form')
	{
		parent::__construct();
		$this->name = $name;
		$this->fields = $this->fields();
		$this->valid = false;
		if (!empty($_POST[$this->name]))
		{
			$this->errors = $this->handlePost($_POST[$this->name]);
			$this->data = $_POST[$this->name];
			if ($this->errors === true)
			{ 
				$this->valid = true;
			}
		}
		else
		{
			$this->errors = [];
			$this->data = [];
		}
	}
	
}